@model MMGC.Models.Patient
@{
    ViewData["Title"] = "Patient Details";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-person-circle"></i> Patient Details</h2>
    <div>
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">
            <i class="bi bi-pencil"></i> Edit
        </a>
        <a asp-action="Index" class="btn btn-secondary">Back to List</a>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Patient Information</h5>
            </div>
            <div class="card-body">
                <p><strong>MR Number:</strong> @Model.MRNumber</p>
                <p><strong>Name:</strong> @Model.FullName</p>
                <p><strong>Contact:</strong> @Model.ContactNumber</p>
                @if (!string.IsNullOrEmpty(Model.AlternateContact))
                {
                    <p><strong>Alternate Contact:</strong> @Model.AlternateContact</p>
                }
                @if (!string.IsNullOrEmpty(Model.Email))
                {
                    <p><strong>Email:</strong> @Model.Email</p>
                }
                <p><strong>Age:</strong> @Model.Age</p>
                <p><strong>Gender:</strong> @Model.Gender</p>
                <p><strong>Date of Birth:</strong> @Model.DateOfBirth.ToString("dd MMM yyyy")</p>
                @if (!string.IsNullOrEmpty(Model.Address))
                {
                    <p><strong>Address:</strong> @Model.Address</p>
                }
                @if (!string.IsNullOrEmpty(Model.MedicalHistory))
                {
                    <p><strong>Medical History:</strong> @Model.MedicalHistory</p>
                }
                @if (!string.IsNullOrEmpty(Model.Allergies))
                {
                    <p><strong>Allergies:</strong> @Model.Allergies</p>
                }
            </div>
        </div>
    </div>
    <div class="col-md-8">
        <!-- Appointments -->
        <div class="card mb-3">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Appointments (@Model.Appointments.Count)</h5>
            </div>
            <div class="card-body">
                @if (Model.Appointments.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Doctor</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var appointment in Model.Appointments.OrderByDescending(a => a.AppointmentDate))
                                {
                                    <tr>
                                        <td>@appointment.AppointmentDate.ToString("dd MMM yyyy hh:mm tt")</td>
                                        <td>@(appointment.Doctor?.FullName ?? "Not Assigned")</td>
                                        <td>@appointment.AppointmentType</td>
                                        <td><span class="badge bg-primary">@appointment.Status</span></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted">No appointments found.</p>
                }
            </div>
        </div>

        <!-- Procedures -->
        <div class="card mb-3">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Procedures (@Model.Procedures.Count)</h5>
            </div>
            <div class="card-body">
                @if (Model.Procedures.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Procedure</th>
                                    <th>Doctor</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var procedure in Model.Procedures.OrderByDescending(p => p.ProcedureDate))
                                {
                                    <tr>
                                        <td>@procedure.ProcedureDate.ToString("dd MMM yyyy")</td>
                                        <td>@procedure.ProcedureName</td>
                                        <td>@procedure.Doctor?.FullName</td>
                                        <td><span class="badge bg-success">@procedure.Status</span></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted">No procedures found.</p>
                }
            </div>
        </div>

        <!-- Lab Tests -->
        <div class="card mb-3">
            <div class="card-header bg-warning text-white">
                <h5 class="mb-0">Lab Tests (@Model.LabTests.Count)</h5>
            </div>
            <div class="card-body">
                @if (Model.LabTests.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Test Name</th>
                                    <th>Category</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var labTest in Model.LabTests.OrderByDescending(lt => lt.TestDate))
                                {
                                    <tr>
                                        <td>@labTest.TestDate.ToString("dd MMM yyyy")</td>
                                        <td>@labTest.TestName</td>
                                        <td>@labTest.LabTestCategory?.CategoryName</td>
                                        <td><span class="badge bg-warning">@labTest.Status</span></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted">No lab tests found.</p>
                }
            </div>
        </div>

        <!-- Transactions -->
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Transactions (@Model.Transactions.Count)</h5>
            </div>
            <div class="card-body">
                @if (Model.Transactions.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Payment Mode</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var transaction in Model.Transactions.OrderByDescending(t => t.TransactionDate))
                                {
                                    <tr>
                                        <td>@transaction.TransactionDate.ToString("dd MMM yyyy")</td>
                                        <td>@transaction.Description</td>
                                        <td>PKR @transaction.Amount.ToString("N2")</td>
                                        <td>@transaction.PaymentMode</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted">No transactions found.</p>
                }
            </div>
        </div>
    </div>
</div>
